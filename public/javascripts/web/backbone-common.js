(function(){function e(t,n,i){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;if(t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped),t.isEqual&&w.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&w.isFunction(n.isEqual))return n.isEqual(t);var r=l.call(t);if(r!=l.call(n))return!1;switch(r){case"[object String]":return t==""+n;case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var a=i.length;a--;)if(i[a]==t)return!0;i.push(t);var a=0,s=!0;if("[object Array]"==r){if(a=t.length,s=a==n.length)for(;a--&&(s=a in t==a in n&&e(t[a],n[a],i)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var o in t)if(w.has(t,o)&&(a++,!(s=w.has(n,o)&&e(t[o],n[o],i))))break;if(s){for(o in n)if(w.has(n,o)&&!a--)break;s=!a}}return i.pop(),s}var t=this,n=t._,i={},r=Array.prototype,a=Object.prototype,s=r.slice,o=r.unshift,l=a.toString,u=a.hasOwnProperty,c=r.forEach,d=r.map,h=r.reduce,p=r.reduceRight,f=r.filter,g=r.every,m=r.some,v=r.indexOf,y=r.lastIndexOf,a=Array.isArray,b=Object.keys,_=Function.prototype.bind,w=function(e){return new $(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):t._=w,w.VERSION="1.3.3";var x=w.each=w.forEach=function(e,t,n){if(null!=e)if(c&&e.forEach===c)e.forEach(t,n);else if(e.length===+e.length)for(var r=0,a=e.length;a>r&&!(r in e&&t.call(n,e[r],r,e)===i);r++);else for(r in e)if(w.has(e,r)&&t.call(n,e[r],r,e)===i)break};w.map=w.collect=function(e,t,n){var i=[];return null==e?i:d&&e.map===d?e.map(t,n):(x(e,function(e,r,a){i[i.length]=t.call(n,e,r,a)}),e.length===+e.length&&(i.length=e.length),i)},w.reduce=w.foldl=w.inject=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),h&&e.reduce===h)return i&&(t=w.bind(t,i)),r?e.reduce(t,n):e.reduce(t);if(x(e,function(e,a,s){r?n=t.call(i,n,e,a,s):(n=e,r=!0)}),!r)throw new TypeError("Reduce of empty array with no initial value");return n},w.reduceRight=w.foldr=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return i&&(t=w.bind(t,i)),r?e.reduceRight(t,n):e.reduceRight(t);var a=w.toArray(e).reverse();return i&&!r&&(t=w.bind(t,i)),r?w.reduce(a,t,n,i):w.reduce(a,t)},w.find=w.detect=function(e,t,n){var i;return k(e,function(e,r,a){return t.call(n,e,r,a)?(i=e,!0):void 0}),i},w.filter=w.select=function(e,t,n){var i=[];return null==e?i:f&&e.filter===f?e.filter(t,n):(x(e,function(e,r,a){t.call(n,e,r,a)&&(i[i.length]=e)}),i)},w.reject=function(e,t,n){var i=[];return null==e?i:(x(e,function(e,r,a){t.call(n,e,r,a)||(i[i.length]=e)}),i)},w.every=w.all=function(e,t,n){var r=!0;return null==e?r:g&&e.every===g?e.every(t,n):(x(e,function(e,a,s){return(r=r&&t.call(n,e,a,s))?void 0:i}),!!r)};var k=w.some=w.any=function(e,t,n){t||(t=w.identity);var r=!1;return null==e?r:m&&e.some===m?e.some(t,n):(x(e,function(e,a,s){return r||(r=t.call(n,e,a,s))?i:void 0}),!!r)};w.include=w.contains=function(e,t){var n=!1;return null==e?n:v&&e.indexOf===v?-1!=e.indexOf(t):n=k(e,function(e){return e===t})},w.invoke=function(e,t){var n=s.call(arguments,2);return w.map(e,function(e){return(w.isFunction(t)?t||e:e[t]).apply(e,n)})},w.pluck=function(e,t){return w.map(e,function(e){return e[t]})},w.max=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&w.isEmpty(e))return-1/0;var i={computed:-1/0};return x(e,function(e,r,a){r=t?t.call(n,e,r,a):e,r>=i.computed&&(i={value:e,computed:r})}),i.value},w.min=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&w.isEmpty(e))return 1/0;var i={computed:1/0};return x(e,function(e,r,a){r=t?t.call(n,e,r,a):e,i.computed>r&&(i={value:e,computed:r})}),i.value},w.shuffle=function(e){var t,n=[];return x(e,function(e,i){t=Math.floor(Math.random()*(i+1)),n[i]=n[t],n[t]=e}),n},w.sortBy=function(e,t,n){var i=w.isFunction(t)?t:function(e){return e[t]};return w.pluck(w.map(e,function(e,t,r){return{value:e,criteria:i.call(n,e,t,r)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;return void 0===n?1:void 0===i?-1:i>n?-1:n>i?1:0}),"value")},w.groupBy=function(e,t){var n={},i=w.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var r=i(e,t);(n[r]||(n[r]=[])).push(e)}),n},w.sortedIndex=function(e,t,n){n||(n=w.identity);for(var i=0,r=e.length;r>i;){var a=i+r>>1;n(e[a])<n(t)?i=a+1:r=a}return i},w.toArray=function(e){return e?w.isArray(e)||w.isArguments(e)?s.call(e):e.toArray&&w.isFunction(e.toArray)?e.toArray():w.values(e):[]},w.size=function(e){return w.isArray(e)?e.length:w.keys(e).length},w.first=w.head=w.take=function(e,t,n){return null==t||n?e[0]:s.call(e,0,t)},w.initial=function(e,t,n){return s.call(e,0,e.length-(null==t||n?1:t))},w.last=function(e,t,n){return null==t||n?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},w.rest=w.tail=function(e,t,n){return s.call(e,null==t||n?1:t)},w.compact=function(e){return w.filter(e,function(e){return!!e})},w.flatten=function(e,t){return w.reduce(e,function(e,n){return w.isArray(n)?e.concat(t?n:w.flatten(n)):(e[e.length]=n,e)},[])},w.without=function(e){return w.difference(e,s.call(arguments,1))},w.uniq=w.unique=function(e,t,n){var n=n?w.map(e,n):e,i=[];return 3>e.length&&(t=!0),w.reduce(n,function(n,r,a){return(t?w.last(n)===r&&n.length:w.include(n,r))||(n.push(r),i.push(e[a])),n},[]),i},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=w.intersect=function(e){var t=s.call(arguments,1);return w.filter(w.uniq(e),function(e){return w.every(t,function(t){return w.indexOf(t,e)>=0})})},w.difference=function(e){var t=w.flatten(s.call(arguments,1),!0);return w.filter(e,function(e){return!w.include(t,e)})},w.zip=function(){for(var e=s.call(arguments),t=w.max(w.pluck(e,"length")),n=Array(t),i=0;t>i;i++)n[i]=w.pluck(e,""+i);return n},w.indexOf=function(e,t,n){if(null==e)return-1;var i;if(n)return n=w.sortedIndex(e,t),e[n]===t?n:-1;if(v&&e.indexOf===v)return e.indexOf(t);for(n=0,i=e.length;i>n;n++)if(n in e&&e[n]===t)return n;return-1},w.lastIndexOf=function(e,t){if(null==e)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},w.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0);for(var n=arguments[2]||1,i=Math.max(Math.ceil((t-e)/n),0),r=0,a=Array(i);i>r;)a[r++]=e,e+=n;return a};var D=function(){};w.bind=function(e,t){var n,i;if(e.bind===_&&_)return _.apply(e,s.call(arguments,1));if(!w.isFunction(e))throw new TypeError;return i=s.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(s.call(arguments)));D.prototype=e.prototype;var r=new D,a=e.apply(r,i.concat(s.call(arguments)));return Object(a)===a?a:r}},w.bindAll=function(e){var t=s.call(arguments,1);return 0==t.length&&(t=w.functions(e)),x(t,function(t){e[t]=w.bind(e[t],e)}),e},w.memoize=function(e,t){var n={};return t||(t=w.identity),function(){var i=t.apply(this,arguments);return w.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},w.delay=function(e,t){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},w.defer=function(e){return w.delay.apply(w,[e,1].concat(s.call(arguments,1)))},w.throttle=function(e,t){var n,i,r,a,s,o,l=w.debounce(function(){s=a=!1},t);return function(){return n=this,i=arguments,r||(r=setTimeout(function(){r=null,s&&e.apply(n,i),l()},t)),a?s=!0:o=e.apply(n,i),l(),a=!0,o}},w.debounce=function(e,t,n){var i;return function(){var r=this,a=arguments;n&&!i&&e.apply(r,a),clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(r,a)},t)}},w.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments))}},w.wrap=function(e,t){return function(){var n=[e].concat(s.call(arguments,0));return t.apply(this,n)}},w.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},w.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},w.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t,n=[];for(t in e)w.has(e,t)&&(n[n.length]=t);return n},w.values=function(e){return w.map(e,w.identity)},w.functions=w.methods=function(e){var t,n=[];for(t in e)w.isFunction(e[t])&&n.push(t);return n.sort()},w.extend=function(e){return x(s.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},w.pick=function(e){var t={};return x(w.flatten(s.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},w.defaults=function(e){return x(s.call(arguments,1),function(t){for(var n in t)null==e[n]&&(e[n]=t[n])}),e},w.clone=function(e){return w.isObject(e)?w.isArray(e)?e.slice():w.extend({},e):e},w.tap=function(e,t){return t(e),e},w.isEqual=function(t,n){return e(t,n,[])},w.isEmpty=function(e){if(null==e)return!0;if(w.isArray(e)||w.isString(e))return 0===e.length;for(var t in e)if(w.has(e,t))return!1;return!0},w.isElement=function(e){return!(!e||1!=e.nodeType)},w.isArray=a||function(e){return"[object Array]"==l.call(e)},w.isObject=function(e){return e===Object(e)},w.isArguments=function(e){return"[object Arguments]"==l.call(e)},w.isArguments(arguments)||(w.isArguments=function(e){return!(!e||!w.has(e,"callee"))}),w.isFunction=function(e){return"[object Function]"==l.call(e)},w.isString=function(e){return"[object String]"==l.call(e)},w.isNumber=function(e){return"[object Number]"==l.call(e)},w.isFinite=function(e){return w.isNumber(e)&&isFinite(e)},w.isNaN=function(e){return e!==e},w.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==l.call(e)},w.isDate=function(e){return"[object Date]"==l.call(e)},w.isRegExp=function(e){return"[object RegExp]"==l.call(e)},w.isNull=function(e){return null===e},w.isUndefined=function(e){return void 0===e},w.has=function(e,t){return u.call(e,t)},w.noConflict=function(){return t._=n,this},w.identity=function(e){return e},w.times=function(e,t,n){for(var i=0;e>i;i++)t.call(n,i)},w.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},w.result=function(e,t){if(null==e)return null;var n=e[t];return w.isFunction(n)?n.call(e):n},w.mixin=function(e){x(w.functions(e),function(t){O(t,w[t]=e[t])})};var C=0;w.uniqueId=function(e){var t=C++;return e?e+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M,N=/.^/,T={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(M in T)T[T[M]]=M;var S=/\\|'|\r|\n|\t|\u2028|\u2029/g,E=/\\(\\|'|r|n|t|u2028|u2029)/g,A=function(e){return e.replace(E,function(e,t){return T[t]})};w.template=function(e,t,n){n=w.defaults(n||{},w.templateSettings),e="__p+='"+e.replace(S,function(e){return"\\"+T[e]}).replace(n.escape||N,function(e,t){return"'+\n_.escape("+A(t)+")+\n'"}).replace(n.interpolate||N,function(e,t){return"'+\n("+A(t)+")+\n'"}).replace(n.evaluate||N,function(e,t){return"';\n"+A(t)+"\n;__p+='"})+"';\n",n.variable||(e="with(obj||{}){\n"+e+"}\n");var e="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+e+"return __p;\n",i=Function(n.variable||"obj","_",e);return t?i(t,w):(t=function(e){return i.call(this,e,w)},t.source="function("+(n.variable||"obj")+"){\n"+e+"}",t)},w.chain=function(e){return w(e).chain()};var $=function(e){this._wrapped=e};w.prototype=$.prototype;var I=function(e,t){return t?w(e).chain():e},O=function(e,t){$.prototype[e]=function(){var e=s.call(arguments);return o.call(e,this._wrapped),I(t.apply(w,e),this._chain)}};w.mixin(w),x("pop,push,reverse,shift,sort,splice,unshift".split(","),function(e){var t=r[e];$.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var i=n.length;return("shift"==e||"splice"==e)&&0===i&&delete n[0],I(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];$.prototype[e]=function(){return I(t.apply(this._wrapped,arguments),this._chain)}}),$.prototype.chain=function(){return this._chain=!0,this},$.prototype.value=function(){return this._wrapped}}).call(this),function(e){"use strict";var t=String.prototype.trim,n=String.prototype.trimRight,i=String.prototype.trimLeft,r=function(e){return 1*e||0},a=function(e,t,n){e+="",t=~~t;for(var i=[];t>0;i[--t]=e);return i.join(null==n?"":n)},s=function(e){return Array.prototype.slice.call(e)},o=function(e){return null!=e?"["+h.escapeRegExp(""+e)+"]":"\\s"},l={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},u={};for(var c in l)u[l[c]]=c;var d=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var t=a,n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,i){var r,a,s,o,l,u,c,h=1,p=n.length,f="",g=[];for(a=0;p>a;a++)if(f=e(n[a]),"string"===f)g.push(n[a]);else if("array"===f){if(o=n[a],o[2])for(r=i[h],s=0;o[2].length>s;s++){if(!r.hasOwnProperty(o[2][s]))throw Error(d('[_.sprintf] property "%s" does not exist',o[2][s]));r=r[o[2][s]]}else r=o[1]?i[o[1]]:i[h++];if(/[^s]/.test(o[8])&&"number"!=e(r))throw Error(d("[_.sprintf] expecting number but found %s",e(r)));switch(o[8]){case"b":r=r.toString(2);break;case"c":r=String.fromCharCode(r);break;case"d":r=parseInt(r,10);break;case"e":r=o[7]?r.toExponential(o[7]):r.toExponential();break;case"f":r=o[7]?parseFloat(r).toFixed(o[7]):parseFloat(r);break;case"o":r=r.toString(8);break;case"s":r=(r+="")&&o[7]?r.substring(0,o[7]):r;break;case"u":r=Math.abs(r);break;case"x":r=r.toString(16);break;case"X":r=r.toString(16).toUpperCase()}r=/[def]/.test(o[8])&&o[3]&&r>=0?"+"+r:r,u=o[4]?"0"==o[4]?"0":o[4].charAt(1):" ",c=o[6]-(r+"").length,l=o[6]?t(u,c):"",g.push(o[5]?r+l:l+r)}return g.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],i=[],r=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))i.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))i.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw Error("[_.sprintf] huh?");if(n[2]){r|=1;var a=[],s=n[2],o=[];if(null===(o=/^([a-z_][a-z_\d]*)/i.exec(s)))throw Error("[_.sprintf] huh?");for(a.push(o[1]);""!==(s=s.substring(o[0].length));)if(null!==(o=/^\.([a-z_][a-z_\d]*)/i.exec(s)))a.push(o[1]);else{if(null===(o=/^\[(\d+)\]/.exec(s)))throw Error("[_.sprintf] huh?");a.push(o[1])}n[2]=a}else r|=2;if(3===r)throw Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");i.push(n)}t=t.substring(n[0].length)}return i},n}(),h={VERSION:"2.1.1",isBlank:function(e){return/^\s*$/.test(e)},stripTags:function(e){return(""+e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){return e+="",e.charAt(0).toUpperCase()+e.substring(1)},chop:function(e,t){e+="",t=~~t||e.length;for(var n=[],i=0;e.length>i;i+=t)n.push(e.slice(i,i+t));return n},clean:function(e){return h.strip(e).replace(/\s+/g," ")},count:function(e,t){return e+="",t+="",e.split(t).length-1},chars:function(e){return(""+e).split("")},escapeHTML:function(e){return(""+e).replace(/[&<>"']/g,function(e){return"&"+u[e]+";"})},unescapeHTML:function(e){return(""+e).replace(/\&([^;]+);/g,function(e,t){var n;return t in l?l[t]:(n=t.match(/^#x([\da-fA-F]+)$/))?String.fromCharCode(parseInt(n[1],16)):(n=t.match(/^#(\d+)$/))?String.fromCharCode(~~n[1]):e})},escapeRegExp:function(e){return e.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},insert:function(e,t,n){var i=h.chars(e);return i.splice(~~t,0,""+n),i.join("")},include:function(e,t){return!!~(""+e).indexOf(t)},join:function(){var e=s(arguments);return e.join(e.shift())},lines:function(e){return(""+e).split("\n")},reverse:function(e){return h.chars(e).reverse().join("")},splice:function(e,t,n,i){var r=h.chars(e);return r.splice(~~t,~~n,i),r.join("")},startsWith:function(e,t){return e+="",t+="",e.length>=t.length&&e.substring(0,t.length)===t},endsWith:function(e,t){return e+="",t+="",e.length>=t.length&&e.substring(e.length-t.length)===t},succ:function(e){e+="";var t=h.chars(e);return t.splice(e.length-1,1,String.fromCharCode(e.charCodeAt(e.length-1)+1)),t.join("")},titleize:function(e){return(""+e).replace(/\b./g,function(e){return e.toUpperCase()})},camelize:function(e){return h.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t&&t.toUpperCase()})},underscored:function(e){return h.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return h.trim(e).replace(/[_\s]+/g,"-").replace(/([A-Z])/g,"-$1").replace(/-+/g,"-").toLowerCase()},classify:function(e){return e+="",h.titleize(e.replace(/_/g," ")).replace(/\s/g,"")},humanize:function(e){return h.capitalize(this.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,n){return e+="",!n&&t?t.call(e):(n=o(n),e.replace(RegExp("^"+n+"+|"+n+"+$","g"),""))},ltrim:function(e,t){return e+="",!t&&i?i.call(e):(t=o(t),e.replace(RegExp("^"+t+"+"),""))},rtrim:function(e,t){return e+="",!t&&n?n.call(e):(t=o(t),e.replace(RegExp(t+"+$"),""))},truncate:function(e,t,n){return e+="",n=n||"...",t=~~t,e.length>t?e.slice(0,t)+n:e},prune:function(e,t,n){e+="",t=~~t,n=null!=n?""+n:"...";var i,r,a=e.replace(/\W/g,function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "});return r=a.charAt(t),i=a.slice(0,t),r&&r.match(/\S/)&&(i=i.replace(/\s\S+$/,"")),i=h.rtrim(i),(i+n).length>e.length?e:e.substring(0,i.length)+n},words:function(e,t){return h.trim(e,t).split(t||/\s+/)},pad:function(e,t,n,i){e+="";var r=0;switch(t=~~t,n?n.length>1&&(n=n.charAt(0)):n=" ",i){case"right":return r=t-e.length,e+a(n,r);case"both":return r=t-e.length,a(n,Math.ceil(r/2))+e+a(n,Math.floor(r/2));default:return r=t-e.length,a(n,r)+e}},lpad:function(e,t,n){return h.pad(e,t,n)},rpad:function(e,t,n){return h.pad(e,t,n,"right")},lrpad:function(e,t,n){return h.pad(e,t,n,"both")},sprintf:d,vsprintf:function(e,t){return t.unshift(e),d.apply(null,t)},toNumber:function(e,t){e+="";var n=r(r(e).toFixed(~~t));return 0!==n||e.match(/^0+$/)?n:Number.NaN},strRight:function(e,t){e+="",t=null!=t?""+t:t;var n=t?e.indexOf(t):-1;return~n?e.slice(n+t.length,e.length):e},strRightBack:function(e,t){e+="",t=null!=t?""+t:t;var n=t?e.lastIndexOf(t):-1;return~n?e.slice(n+t.length,e.length):e},strLeft:function(e,t){e+="",t=null!=t?""+t:t;var n=t?e.indexOf(t):-1;return~n?e.slice(0,n):e},strLeftBack:function(e,t){e+="",t=null!=t?""+t:t;var n=e.lastIndexOf(t);return~n?e.slice(0,n):e},toSentence:function(e,t,n){t||(t=", "),n||(n=" and ");for(var i=e.length,r="",a=0;i>a;a++)r+=e[a],a===i-2?r+=n:i-1>a&&(r+=t);return r},slugify:function(e){var t="膮脿谩盲芒茫膰臋猫茅毛锚矛铆茂卯艂艅貌贸枚么玫霉煤眉没帽莽偶藕",n="aaaaaaceeeeeiiiilnooooouuuunczz",i=RegExp(o(t),"g");return e=(""+e).toLowerCase(),e=e.replace(i,function(e){var i=t.indexOf(e);return n.charAt(i)||"-"}),h.trim(e.replace(/[^\w\s-]/g,"").replace(/[-\s]+/g,"-"),"-")},exports:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&!~h.words("include contains reverse").indexOf(t)&&(e[t]=this[t]);return e},repeat:a};h.strip=h.trim,h.lstrip=h.ltrim,h.rstrip=h.rtrim,h.center=h.lrpad,h.rjust=h.lpad,h.ljust=h.rpad,h.contains=h.include,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(module.exports=h),exports._s=h):"function"==typeof define&&define.amd?define("underscore.string",function(){return h}):(e._=e._||{},e._.string=e._.str=h)}(this||window),function(){var e,t=this,n=t.Backbone,i=Array.prototype.slice,r=Array.prototype.splice;e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="0.9.2";var a=t._;!a&&"undefined"!=typeof require&&(a=require("underscore"));var s=t.jQuery||t.Zepto||t.ender;e.setDomLibrary=function(e){s=e},e.noConflict=function(){return t.Backbone=n,this},e.emulateHTTP=!1,e.emulateJSON=!1;var o=/\s+/,l=e.Events={on:function(e,t,n){var i,r,a,s,l;if(!t)return this;for(e=e.split(o),i=this._callbacks||(this._callbacks={});r=e.shift();)a=(l=i[r])?l.tail:{},a.next=s={},a.context=n,a.callback=t,i[r]={tail:s,next:l?l.next:a};return this},off:function(e,t,n){var i,r,s,l,u,c;if(r=this._callbacks){if(!e&&!t&&!n)return delete this._callbacks,this;for(e=e?e.split(o):a.keys(r);i=e.shift();)if(s=r[i],delete r[i],s&&(t||n))for(l=s.tail;(s=s.next)!==l;)u=s.callback,c=s.context,(t&&u!==t||n&&c!==n)&&this.on(i,u,c);return this}},trigger:function(e){var t,n,r,a,s,l;if(!(r=this._callbacks))return this;for(s=r.all,e=e.split(o),l=i.call(arguments,1);t=e.shift();){if(n=r[t])for(a=n.tail;(n=n.next)!==a;)n.callback.apply(n.context||this,l);if(n=s)for(a=n.tail,t=[t].concat(l);(n=n.next)!==a;)n.callback.apply(n.context||this,t)}return this}};l.bind=l.on,l.unbind=l.off;var u=e.Model=function(e,t){var n;e||(e={}),t&&t.parse&&(e=this.parse(e)),(n=D(this,"defaults"))&&(e=a.extend({},n,e)),t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=a.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=a.clone(this.attributes),this.initialize.apply(this,arguments)};a.extend(u.prototype,l,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;return(t=this._escapedAttributes[e])?t:(t=this.get(e),this._escapedAttributes[e]=a.escape(null==t?"":""+t))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var i,r;if(a.isObject(e)||null==e?(i=e,n=t):(i={},i[e]=t),n||(n={}),!i)return this;if(i instanceof u&&(i=i.attributes),n.unset)for(r in i)i[r]=void 0;if(!this._validate(i,n))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var t=n.changes={},s=this.attributes,o=this._escapedAttributes,l=this._previousAttributes||{};for(r in i)e=i[r],(!a.isEqual(s[r],e)||n.unset&&a.has(s,r))&&(delete o[r],(n.silent?this._silent:t)[r]=!0),n.unset?delete s[r]:s[r]=e,a.isEqual(l[r],e)&&a.has(s,r)==a.has(l,r)?(delete this.changed[r],delete this._pending[r]):(this.changed[r]=e,n.silent||(this._pending[r]=!0));return n.silent||this.change(n),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(a.clone(this.attributes),e)},fetch:function(t){var t=t?a.clone(t):{},n=this,i=t.success;return t.success=function(e,r,a){return n.set(n.parse(e,a),t)?(i&&i(n,e),void 0):!1},t.error=e.wrapError(t.error,n,t),(this.sync||e.sync).call(this,"read",this,t)},save:function(t,n,i){var r,s;if(a.isObject(t)||null==t?(r=t,i=n):(r={},r[t]=n),i=i?a.clone(i):{},i.wait){if(!this._validate(r,i))return!1;s=a.clone(this.attributes)}if(t=a.extend({},i,{silent:!0}),r&&!this.set(r,i.wait?t:i))return!1;var o=this,l=i.success;return i.success=function(e,t,n){return t=o.parse(e,n),i.wait&&(delete i.wait,t=a.extend(r||{},t)),o.set(t,i)?(l?l(o,e):o.trigger("sync",o,e,i),void 0):!1},i.error=e.wrapError(i.error,o,i),n=this.isNew()?"create":"update",n=(this.sync||e.sync).call(this,n,this,i),i.wait&&this.set(s,t),n},destroy:function(t){var t=t?a.clone(t):{},n=this,i=t.success,r=function(){n.trigger("destroy",n,n.collection,t)};if(this.isNew())return r(),!1;t.success=function(e){t.wait&&r(),i?i(n,e):n.trigger("sync",n,e,t)},t.error=e.wrapError(t.error,n,t);var s=(this.sync||e.sync).call(this,"delete",this,t);return t.wait||r(),s},url:function(){var e=D(this,"urlRoot")||D(this.collection,"url")||C();return this.isNew()?e:e+("/"==e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var i=a.extend({},e.changes,this._silent);this._silent={};for(n in i)this.trigger("change:"+n,this,this.get(n),e);if(t)return this;for(;!a.isEmpty(this._pending);){this._pending={},this.trigger("change",this,e);for(n in this.changed)!this._pending[n]&&!this._silent[n]&&delete this.changed[n];this._previousAttributes=a.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?a.has(this.changed,e):!a.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?a.clone(this.changed):!1;var t,n,i=!1,r=this._previousAttributes;for(n in e)a.isEqual(r[n],t=e[n])||((i||(i={}))[n]=t);return i},previous:function(e){return arguments.length&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return a.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;var e=a.extend({},this.attributes,e),n=this.validate(e,t);return n?(t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}});var c=e.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};a.extend(c.prototype,l,{model:u,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var n,i,s,o,l,u={},c={},d=[];for(t||(t={}),e=a.isArray(e)?e.slice():[e],n=0,i=e.length;i>n;n++){if(!(s=e[n]=this._prepareModel(e[n],t)))throw Error("Can't add an invalid model to a collection");o=s.cid,l=s.id,u[o]||this._byCid[o]||null!=l&&(c[l]||this._byId[l])?d.push(n):u[o]=c[l]=s}for(n=d.length;n--;)e.splice(d[n],1);for(n=0,i=e.length;i>n;n++)(s=e[n]).on("all",this._onModelEvent,this),this._byCid[s.cid]=s,null!=s.id&&(this._byId[s.id]=s);if(this.length+=i,r.apply(this.models,[null!=t.at?t.at:this.models.length,0].concat(e)),this.comparator&&this.sort({silent:!0}),t.silent)return this;for(n=0,i=this.models.length;i>n;n++)u[(s=this.models[n]).cid]&&(t.index=n,s.trigger("add",s,this,t));return this},remove:function(e,t){var n,i,r,s;for(t||(t={}),e=a.isArray(e)?e.slice():[e],n=0,i=e.length;i>n;n++)(s=this.getByCid(e[n])||this.get(e[n]))&&(delete this._byId[s.id],delete this._byCid[s.cid],r=this.indexOf(s),this.models.splice(r,1),this.length--,t.silent||(t.index=r,s.trigger("remove",s,this,t)),this._removeReference(s));return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,a.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return a.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(e||(e={}),!this.comparator)throw Error("Cannot sort a set without a comparator");var t=a.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return a.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return this._reset(),this.add(e,a.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(t){t=t?a.clone(t):{},void 0===t.parse&&(t.parse=!0);var n=this,i=t.success;return t.success=function(e,r,a){n[t.add?"add":"reset"](n.parse(e,a),t),i&&i(n,e)},t.error=e.wrapError(t.error,n,t),(this.sync||e.sync).call(this,"read",this,t)},create:function(e,t){var n=this,t=t?a.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var i=t.success;return t.success=function(r,a){t.wait&&n.add(r,t),i?i(r,a):r.trigger("sync",e,a,t)},e.save(null,t),e},parse:function(e){return e},chain:function(){return a(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){return t||(t={}),e instanceof u?e.collection||(e.collection=this):(t.collection=this,e=new this.model(e,t),e._validate(e.attributes,t)||(e=!1)),e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"==e||"remove"==e)&&n!=this||("destroy"==e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments))}}),a.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(e){c.prototype[e]=function(){return a[e].apply(a,[this.models].concat(a.toArray(arguments)))}});var d=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},h=/:\w+/g,p=/\*\w+/g,f=/[-[\]{}()+?.,\\^$|#\s]/g;a.extend(d.prototype,l,{initialize:function(){},route:function(t,n,i){return e.history||(e.history=new g),a.isRegExp(t)||(t=this._routeToRegExp(t)),i||(i=this[n]),e.history.route(t,a.bind(function(r){r=this._extractParameters(t,r),i&&i.apply(this,r),this.trigger.apply(this,["route:"+n].concat(r)),e.history.trigger("route",this,n,r)},this)),this},navigate:function(t,n){e.history.navigate(t,n)},_bindRoutes:function(){if(this.routes){var e,t=[];for(e in this.routes)t.unshift([e,this.routes[e]]);e=0;for(var n=t.length;n>e;e++)this.route(t[e][0],t[e][1],this[t[e][1]])}},_routeToRegExp:function(e){return e=e.replace(f,"\\$&").replace(h,"([^/]+)").replace(p,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var g=e.History=function(){this.handlers=[],a.bindAll(this,"checkUrl")},m=/^[#\/]/,v=/msie [\w.]+/;g.started=!1,a.extend(g.prototype,l,{interval:50,getHash:function(e){return(e=(e?e.location:window.location).href.match(/#(.*)$/))?e[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||t){var e=window.location.pathname,n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(m,"")},start:function(e){if(g.started)throw Error("Backbone.history has already been started");g.started=!0,this.options=a.extend({},{root:"/"},this.options,e),this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var e=this.getFragment(),t=document.documentMode;return(t=v.exec(navigator.userAgent.toLowerCase())&&(!t||7>=t))&&(this.iframe=s('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?s(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!t?s(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e,e=window.location,t=e.pathname==this.options.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!t?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&t&&e.hash&&(this.fragment=this.getHash().replace(m,""),window.history.replaceState({},document.title,e.protocol+"//"+e.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){s(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),g.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e==this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e==this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash()),void 0)
},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return a.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(e,t){if(!g.started)return!1;t&&!0!==t||(t={trigger:t});var n=(e||"").replace(m,"");this.fragment!=n&&(this._hasPushState?(0!=n.indexOf(this.options.root)&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e))},_updateHash:function(e,t,n){n?e.replace((""+e).replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var y=e.View=function(e){this.cid=a.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,_="model,collection,el,id,attributes,className,tagName".split(",");a.extend(y.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){return e=document.createElement(e),t&&s(e).attr(t),n&&s(e).html(n),e},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof s?e:s(e),this.el=this.$el[0],!1!==t&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=D(this,"events"))){this.undelegateEvents();for(var t in e){var n=e[t];if(a.isFunction(n)||(n=this[e[t]]),!n)throw Error('Method "'+e[t]+'" does not exist');var i=t.match(b),r=i[1],i=i[2],n=a.bind(n,this),r=r+(".delegateEvents"+this.cid);""===i?this.$el.bind(r,n):this.$el.delegate(i,r,n)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=a.extend({},this.options,e));for(var t=0,n=_.length;n>t;t++){var i=_[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var e=D(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}}}),u.extend=c.extend=d.extend=y.extend=function(e,t){var n=k(this,e,t);return n.extend=this.extend,n};var w={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};e.sync=function(t,n,i){var r=w[t];i||(i={});var o={type:r,dataType:"json"};return i.url||(o.url=D(n,"url")||C()),i.data||!n||"create"!=t&&"update"!=t||(o.contentType="application/json",o.data=JSON.stringify(n.toJSON())),e.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),!e.emulateHTTP||"PUT"!==r&&"DELETE"!==r||(e.emulateJSON&&(o.data._method=r),o.type="POST",o.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r)}),"GET"!==o.type&&!e.emulateJSON&&(o.processData=!1),s.ajax(a.extend(o,i))},e.wrapError=function(e,t,n){return function(i,r){r=i===t?r:i,e?e(t,r,n):t.trigger("error",t,r,n)}};var x=function(){},k=function(e,t,n){var i;return i=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},a.extend(i,e),x.prototype=e.prototype,i.prototype=new x,t&&a.extend(i.prototype,t),n&&a.extend(i,n),i.prototype.constructor=i,i.__super__=e.prototype,i},D=function(e,t){return e&&e[t]?a.isFunction(e[t])?e[t]():e[t]:null},C=function(){throw Error('A "url" property or function must be specified')}}.call(this);